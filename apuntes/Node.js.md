# Node.JS

# Â¿QuÃ© es Node.js?

Node.js NO es un lenguaje de programaciÃ³n, un framework ni tampoco una librerÃ­a. Es un entorno de ejecuciÃ³n de JavaScript, orientado a eventos asÃ­ncronos. Permite ejecutar JS fuera del navegador (backend, terminal, dispositivos).

- Basado en el motor V8 de Chrome
- **Multiplataforma**: Funciona en servidores, terminal, dispositivos IoT, etc.
- **Monohilo**: Usa un solo hilo principal, pero maneja operaciones asÃ­ncronas mediante el *event loop*.
- **NPM integrado**: Viene con el gestor de paquetes mÃ¡s grande del mundo

**Link (LTS Recomendado)**: [https://nodejs.org/es/download](https://nodejs.org/es/download)

---

## Conceptos bÃ¡sicos

- **REPL** (*Read-Eval-Print Loop*): Consola interactiva de Node para ejecutar JS lÃ­nea por lÃ­nea.
- **globalThis**: Variable global en cualquier entorno.
    - En navegador â†’ `window`
    - En Node.js â†’ `global`
    - DocumentaciÃ³n: [https://nodejs.org/dist/latest/docs/api/globals.html#global](https://nodejs.org/dist/latest/docs/api/globals.html#global)

---

# MÃ³dulos en Node.js

- Un mÃ³dulo es una pieza de funcionalidad contenida en uno o varios archivos JavaScript que puede ser reutilizada dentro de una aplicaciÃ³n. En Node.js, todo archivo `.js` es considerado un mÃ³dulo.

## Sistemas de MÃ³dulos

Existen **dos sistemas principales** para trabajar con mÃ³dulos en Node.js:

### 1. CommonJS (CJS)

- Es el sistema de mÃ³dulos **clÃ¡sico de Node.js**. Se utiliza principalmente en proyectos existentes o antiguos.

```jsx
// Exportar una sola cosa
const nombre = "Juan"
module.exports = nombre

// Exportar varias cosas
function sumar(a, b) { return a + b }
function restar(a, b) { return a - b }
module.exports = { sumar, restar }

// Importar
const nombre = require("./archivo.js")
const { sumar, restar } = require("./operaciones.js")
```

### 2. ECMAScript Modules (ESM)

- Es el estÃ¡ndar oficial de JavaScript, soportado tambiÃ©n en Node.js (requiere usar extensiÃ³n `.mjs` o `"type": "module"` en `package.json`). Se recomienda en proyectos modernos.

```jsx
// Exportar una variable
export const nombre = "Juan"

// Exportar varias funciones
export function sumar(a, b) { return a + b }
export function restar(a, b) { return a - b }

// Importar
import { nombre, sumar } from "./archivo.js"
```

---

## MÃ³dulos Built-in (incorporados)

Node.js incluye varios mÃ³dulos listos para usar, sin necesidad de instalar nada:

- `http` â†’ crear servidores web.
- `https` â†’ trabajar con servidores seguros (SSL).
- `fs` â†’ manipular archivos y directorios.
- `os` â†’ obtener info del sistema operativo.
- `path` â†’ manejar rutas de archivos de forma segura.

## MÃ³dulo process

Provee informaciÃ³n sobre el proceso de Node.js que se estÃ¡ ejecutando.

- `process.argv` â†’ argumentos de la terminal (array).
- `process.memoryUsage()` â†’ uso de memoria.
- `process.cwd()` â†’ ruta del directorio actual.
- `process.exit(codigo)` â†’ terminar el proceso. 0 (Ã©xito) y 1 (error).
- **`process.stdout.write(data)`** â†’ escribe directamente en la salida estÃ¡ndar (similar a console.log, pero sin salto de lÃ­nea automÃ¡tico).
- `process.stdin.on("data", callback)` â†’ lee datos ingresados por el usuario desde la entrada estÃ¡ndar.

```jsx
// Mostrar los argumentos de la terminal
console.log(process.argv); // ["node", "app.js", "arg1", "arg2"]

// Leer datos del usuario
process.stdout.write("\nIngrese su nombre: ");
process.stdin.on("data", (data) => {
  console.log(`Hola ${data.toString().trim()}!`);
  process.exit(0);
});
```

## MÃ³dulo os

Permite obtener informaciÃ³n sobre el sistema operativo.

- `os.type()` â†’ sistema operativo del usuario.
- `os.homedir()` â†’ directorio principal del usuario.
- `os.uptime()` â†’ tiempo encendido en segundos.
- `os.userInfo()` â†’ informaciÃ³n del usuario.

## MÃ³dulo timers

Contiene funciones que ejecutan cÃ³digo luego de un cierto perÃ­odo de tiempo.

- `setTimeout(funcion, retraso, arg1, arg2)` â†’ ejecuta despuÃ©s de cierto tiempo.
- `setImmediate(funcion, arg1, arg2)` â†’ ejecuta al final de la fase actual del event loop (despuÃ©s de todo el cÃ³digo sÃ­ncrono).
- `setInterval(funcion, intervalo, arg1, arg2)` â†’ repite indefinidamente cada cierto tiempo.

## MÃ³dulo fs

Permite trabajar con el sistema de archivos.

- Todos los mÃ©todos son **asÃ­ncronos** por defecto, pero existen versiones sÃ­ncronas con `Sync`.
    - `fs.readFileSync("./index.html", "utf-8")` *â†’ l*eer un archivo de manera sÃ­ncrona
    - `fs.readFile("rutaArchivo", "codificaciÃ³n", (err, content) â‡’ {})` â†’ lectura asÃ­ncrona
    - `fs.renameSync(oldName, newName)` *â†’* renombrar un archivo de manera sÃ­ncrona
    - `fs.rename(oldName, newName, (err) => {...})` *â†’* renombrar un archivo
    - `fs.appendFile("rutaArchivo", "contenido", () => {...})` â†’ agregar contenido al final del archivo

---

# npm (Node Package Manager)

**npm** es el gestor de paquetes oficial de Node.js. Permite instalar, compartir y administrar paquetes (librerÃ­as, herramientas, frameworks, etc.).

## Conceptos clave

- **Paquete** â†’ archivo o conjunto de archivos almacenados en una carpeta y descritos por un `package.json`.
- **MÃ³dulo** â†’ cualquier archivo o directorio dentro de `node_modules` que puede ser importado con `require()` o `import`.
- **Dependencia** â†’ paquete que otro paquete necesita para funcionar correctamente.

## Dependencias de Desarrollo y ProducciÃ³n

- Dependencias de producciÃ³n
    - El proyecto las necesita para funcionar
    - npm i nombreDependencia

- Dependencias de desarrollo
    - 

### Crear un paquete con npm

1. Crear una carpeta con el nombre del proyecto.
2. Inicializar el proyecto:
    - `npm init` â†’ crea un `package.json` configurable paso a paso.
    - `npm init -y` â†’ crea un `package.json` con valores por defecto.

ðŸ“Œ El archivo `package.json` contiene:

- Nombre del proyecto
- VersiÃ³n
- Dependencias (`dependencies`)
- Dependencias de desarrollo (`devDependencies`)
- Scripts personalizados (`npm run script`)

### JSON

JSON (**JavaScript Object Notation**) es un formato de texto ligero para almacenar y transportar informaciÃ³n. Representa datos como pares clave-valor.

```jsx
// JSON a JavaScript (string â†’ objeto)
const obj = JSON.parse(jsonString)

// JavaScript a JSON (objeto â†’ string)
const json = JSON.stringify(obj)
```

### Instalar y desinstalar paquetes

```bash
# Instalar un paquete
npm install nombrePaquete
npm i nombrePaquete

# Desinstalar un paquete
npm uninstall nombrePaquete

# Instalar todas las dependencias listadas en package.json
npm install
npm i

# Instalar dependencias como desarrollador (devDependencies)
npm i nombrePaquete --save-dev
```

### package-lock.json

- Se genera automÃ¡ticamente cuando npm modifica el Ã¡rbol de `node_modules` o `package.json`. Describe el Ã¡rbol generado para que futuras instalaciones puedan generar exactamente el mismo Ã¡rbol (otros desarrolladores pueden instalar exactamente las mismas dependencias).

---

# Eventos

Un **evento** es una acciÃ³n o suceso que ocurre dentro de la aplicaciÃ³n, al cual se puede reaccionar ejecutando cÃ³digo.

- **Eventos AsÃ­ncronos**: Eventos que se ejecutan independientemente del proceso principal de la aplicaciÃ³n (no bloquean la aplicaciÃ³n y continÃºan su ejecuciÃ³n en paralelo) .
- **Eventos SÃ­ncronos**: Eventos que se ejecutan como parte del proceso principal de la aplicaciÃ³n (bloquean la aplicaciÃ³n).

## MÃ³dulo events

El mÃ³dulo `events` proporciona la clase `EventEmitter` y mÃ©todos principales:

- **`emitter.on("evento", callback)`** â†’ registra un listener para un evento.
- **`emitter.once("evento", callback)`** â†’ registra un listener que se ejecuta **solo una vez**.
- **`emitter.emit("evento", [...args])`** â†’ emite el evento, ejecutando los listeners asociados.
- **`emitter.removeListener("evento", callback)`** â†’ elimina un listener especÃ­fico.
- **`emitter.removeAllListeners("evento")`** â†’ elimina todos los listeners de un evento.

- EventEmitter (emisores) â†’ Un **emisor de eventos** es un objeto que puede **emitir** y **escuchar** eventos. En Node.js, los emisores son instancias de la clase `EventEmitter`.

```jsx
const events = require("node:events")

// Emisor de eventos
const emitter = new events.EventEmitter()

// Definir un listener
emisor.on("saludo", (nombre) => {
  console.log(`Hola, ${nombre}!`)
})

// Emitir el evento
emisor.emit("saludo", "Juan") 
```

---

# HTTP y Rutas en Node.js

## Conceptos bÃ¡sicos

- **Cliente** â†’ generalmente el navegador o cualquier aplicaciÃ³n que realiza solicitudes al servidor.
- **Servidor** â†’ programa que corre en un sistema y responde a las solicitudes del cliente.

La comunicaciÃ³n se hace mediante el **protocolo HTTP** (HyperText Transfer Protocol).

### Solicitud HTTP (cliente â†’ servidor)

Una solicitud HTTP estÃ¡ compuesta por:

- **MÃ©todo HTTP** â†’ indica la intenciÃ³n de la solicitud.
- **Ruta (path)** â†’ identifica el recurso solicitado (ej. `/home`, `/about`).
- **VersiÃ³n HTTP** â†’ ejemplo: `HTTP/1.1`.
- **Cabeceras (headers)** â†’ informaciÃ³n adicional (tipo de contenido, cookies, etc.).
- **Cuerpo (body)** â†’ datos enviados (solo en mÃ©todos como `POST` o `PUT`).

### MÃ©todos HTTP principales

- **GET** â†’ obtener un recurso (ej. HTML, CSS, imÃ¡genes).
- **POST** â†’ crear un recurso nuevo (ej. usuario en una base de datos).
- **PUT** â†’ actualizar un recurso existente.
- **DELETE** â†’ eliminar un recurso.

### Respuesta HTTP (servidor â†’ cliente)

- **CÃ³digo de estado** â†’ resultado de la solicitud.
- **Texto de estado** â†’ descripciÃ³n del cÃ³digo.
- **VersiÃ³n HTTP**.
- **Cabeceras**.
- **Cuerpo** â†’ la informaciÃ³n solicitada o un mensaje de error.

### Clases de cÃ³digos de estado

1. **100 - 199** â†’ Respuestas informativas.
2. **200 - 299** â†’ Respuestas exitosas.
3. **300 - 399** â†’ Redirecciones.
4. **400 - 499** â†’ Errores del cliente.
5. **500 - 599** â†’ Errores del servidor.

### CÃ³digos comunes

- **200 OK** â†’ Ã©xito.
- **400 Bad Request** â†’ solicitud incorrecta.
- **404 Not Found** â†’ recurso no encontrado.
- **500 Internal Server Error** â†’ error en el servidor.

### MÃ³dulo http

El mÃ³dulo `http` permite crear servidores que reciben solicitudes y responden con datos.

```jsx
const http = require("node:http");

const host = "127.0.0.1";
const port = 3000;

const server = http.createServer((req, res) => {
  res.statusCode = 200; // 200 OK
  res.setHeader("Content-Type", "text/plain");
  res.end("Hello"); 
});

server.listen(port, host, () => {
  console.log(`Servidor corriendo en http://${host}:${port}`);
});
```

### Conceptos relacionados

- **Puerto** â†’ ubicaciÃ³n virtual en el sistema operativo que permite acceder a una aplicaciÃ³n o proceso (ej. `:3000`).
- **Estructura de una URL** (ejemplo: `https://www.google.com/search`):
    - **Protocolo** â†’ `https`
    - **Subdominio** â†’ `www`
    - **Dominio** â†’ `google`
    - **TLD** â†’ `.com`
    - **Ruta** â†’ `/search`

## MÃ³dulo url

```jsx
const url = require("node:url");
const myUrl = new url.URL("https://www.ejemplo.com/cursos/programacion?lenguaje=nodejs&nivel=basico");

console.log("hostname:", myUrl.hostname); // www.ejemplo.org
console.log("path:", myUrl.pathname) // /cursos/programacion

// URLSearchParams { 'lenguaje' => 'nodejs', 'nivel' => 'basico' }
console.log("search params:", myUrl.searchParams); 
console.log(myUrl.searchParams.get("lenguaje")); 
console.log(myUrl.searchParams.get("nivel")); 
```

---

## Routing

El routing (enrutamiento) consiste en manejar las solicitudes HTTP del cliente en base a ciertos criterios y devolver la respuesta adecuada.

### Criterios

- **MÃ©todo de la solicitud HTTP** (GET, POST, PUT, DELETE, etc.)
- **Path de la solicitud HTTP** (ejemplo: `/`, `/users`, `/movies`)

```jsx
const http = require("node:http");

const HOST = "127.0.0.1";
const PORT = 3000;

const server = http.createServer((req, res) => {
  const { method } = req; // GET, POST, PUT o DELETE

  switch (method) {
    case "GET":
      return manejarSolicitudGet(req, res);

    case "POST":
      return manejarSolicitudPost(req, res);

    default:
      res.statusCode = 501;
      res.end(`El mÃ©todo usado no puede ser manejado por el servidor: ${method}`);
  }
});

function manejarSolicitudGet(req, res) {
  const path = req.url;

  if (path === "/") {
    res.writeHead(200, { "Content-Type": "text/plain; charset=utf-8" });
    return res.end("Bienvenido a la pÃ¡gina de inicio");
  } else if (path === "/about") {
    res.writeHead(200, { "Content-Type": "text/plain; charset=utf-8" });
    return res.end("Acerca de nosotros");
  }

  res.statusCode = 404;
  res.end("El recurso solicitado no existe");
}

function manejarSolicitudPost(req, res) {
  const path = req.url;

  if (path === "/contact") {
    res.writeHead(200, { "Content-Type": "text/plain; charset=utf-8" });
    return res.end("Has enviado un mensaje de contacto");
  }

  res.statusCode = 404;
  res.end("El recurso solicitado no existe");
}

server.listen(PORT, HOST, () => {
  console.log(`Servidor escuchando en http://${HOST}:${PORT}/`);
});
```

### Notas importantes

- `req.method` â†’ devuelve el mÃ©todo HTTP (`GET`, `POST`, etc.).
- `req.url` â†’ devuelve la ruta solicitada (`/`, `/about`, etc.).
- Siempre conviene setear el header `Content-Type` para evitar problemas de codificaciÃ³n (ejemplo con `utf-8`).
- Si la ruta o mÃ©todo no coincide con ninguno definido â†’ responder con `404`.

---

## Recarga automÃ¡tica y monitorizaciÃ³n de cambios

Durante el desarrollo con Node.js, es comÃºn modificar archivos del proyecto y tener que reiniciar el servidor manualmente para aplicar los cambios.

Para evitar esto, existen herramientas que recargan automÃ¡ticamente la aplicaciÃ³n al detectar modificaciones en el cÃ³digo fuente.

### â€”watch

Desde Node.js v18+, se puede usar el flag `--watch` para que el proceso **monitoree los cambios** en los archivos del proyecto y reinicie la aplicaciÃ³n automÃ¡ticamente.

- ejecutar: `node â€”watch <aplicacion>`

### Nodemon

Es una herramienta que facilita el desarrollo con Node.js. Su funciÃ³n principal es reiniciar automÃ¡ticamente la aplicaciÃ³n cuando detecta cambios en los archivos del proyecto.

- instalaciÃ³n global â†’ `npm install -g nodemon`
- instalaciÃ³n â†’ `npm i nodemon -D` â†’ agregar como script en `package.json`
- ejecutar â†’ `nodemon <aplicacion>`
- **DocumentaciÃ³n**: [https://www.npmjs.com/package/nodemon](https://www.npmjs.com/package/nodemon)

---

# Express

Express es el framework web mÃ¡s popular de Node.js. Es una herramienta **minimalista y flexible** que proporciona una estructura para desarrollar servidores y APIs de una manera mÃ¡s sencilla.

- **DocumentaciÃ³n (npm)**: [https://www.npmjs.com/package/express](https://www.npmjs.com/package/express)

## Diferencias entre Nativo y Express

- Express a diferencia de Node.JS nativo, detecta automÃ¡ticamente cual es el `Content-Type` que tiene que utilizar dependiendo de la `response` que se utilice.

## Conceptos bÃ¡sicos

- **CRUD** â†’ operaciones bÃ¡sicas sobre datos:
    - **Create** â†’ `POST`
    - **Read** â†’ `GET`
    - **Update** â†’ `PUT` / `PATCH`
    - **Delete** â†’ `DELETE`
- **API** â†’ interfaz que permite la comunicaciÃ³n entre dos programas. No estÃ¡ pensada para el usuario final, sino para que otros programas consuman sus servicios.
    - Ejemplo: una API REST para obtener informaciÃ³n de libros.

## Primeros Pasos

```jsx
// 1. Inicializar un paquete: npm init
// 2. Instalar express: npm i express
// 3. Crear un servidor bÃ¡sico

const express = require("express");
const app = express(); // Crea la aplicaciÃ³n/servidor

// Ruta de inicio
app.get("/", (req, res) => {
  res.send("Inicio");
});

// ConfiguraciÃ³n del servidor
const host = "localhost";
const port = process.env.PORT || 3000;

app.listen(port, host, () => {
  console.log(`Servidor escuchando en http://${host}:${port}`);
});
```

## ParÃ¡metros en Express

### 1. ParÃ¡metros de ruta (Route Params)

Los **parÃ¡metros de ruta** son partes dinÃ¡micas dentro de la URL. Se definen con `:` y permiten capturar valores enviados directamente en la ruta.

```jsx
app.get("/api/example/:value", (req, res) => {
  const valor = req.params.value; // acceder al parÃ¡metro de la URL
  res.send(`Valor recibido: ${valor}`);
});

// http://localhost:3000/api/example/123
```

### 2. ParÃ¡metros de consulta (Query Params)

Los **query params** son pares clave-valor que se agregan a la URL despuÃ©s de un `?`.

Se accede a ellos mediante `req.query` y son Ãºtiles para **filtrar, ordenar o paginar** resultados.

```jsx
app.get("/api/autores", (req, res) => {
  let resultado = autores;

  // Filtrar por aÃ±o de nacimiento
  if (req.query.year) {
    resultado = resultado.filter(a => a.year == req.query.year);
  }

  // Ordenar alfabÃ©ticamente
  if (req.query.ordenar === "true") {
    resultado = [...resultado].sort((a, b) => a.name.localeCompare(b.name));
  }

  res.json(resultado);
});

// http://localhost:3000/api/autores?year=1828&ordenar=true
```

### Middlewares

Es una funciÃ³n que se ejecuta entre la peticiÃ³n y la respuesta

```jsx
const express = require("express");
const app = express();

// Middleware
app.use((req, res, next) => {
	
})

// Rutas
app.get("/", (req, res) => {
  // express detecta automÃ¡ticamente el content-type, dependiendo de la respuesta
  res.send("<h1>Inicio</h1>");
});

app.listen(3000, () => {
  console.log(`server listening on port http://localhost:3000`);
});
```